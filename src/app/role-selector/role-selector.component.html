<div class="role-selector-container">
  <div class="flex align-items-center gap-2">
    <!-- Role Icon and Label -->
    <div class="flex align-items-center gap-2 mr-2">
      <i
        [class]="currentRoleOption()?.icon || 'pi pi-user'"
        [style.color]="currentRoleOption()?.color || '#6c757d'"
        class="text-lg"
      ></i>
      <span class="font-medium text-sm hidden md:inline">
        {{ currentRoleOption()?.label || 'Select Role' }}
      </span>
    </div>

    <!-- Role Dropdown -->
    <p-select
      (onChange)="onRoleChange($event)"
      [ngModel]="selectedRole()"
      [options]="roleOptions()"
      [showClear]="false"
      [style]="{ minWidth: '200px' }"
      appendTo="body"
      optionLabel="label"
      optionValue="value"
      placeholder="Select Role"
      styleClass="role-dropdown"
      >
      <!-- Selected Item Template -->
      <ng-template pTemplate="selectedItem">
        @if (selectedRole()) {
          <div class="flex align-items-center gap-2">
            <i [class]="currentRoleOption()?.icon" [style.color]="currentRoleOption()?.color"></i>
            <span class="font-medium">{{ currentRoleOption()?.label }}</span>
          </div>
        }
      </ng-template>

      <!-- Dropdown Items Template -->
      <ng-template let-role pTemplate="item">
        <div class="flex align-items-center justify-content-between w-full p-2">
          <div class="flex align-items-center gap-2 flex-1">
            <i [class]="role.icon" [style.color]="role.color" class="text-lg"></i>
            <div class="flex-1">
              <div class="font-medium">{{ role.label }}</div>
              <div class="text-xs text-600 mt-1">{{ role.description }}</div>
            </div>
          </div>
          <div class="text-xs text-500 ml-2">{{ role.category }}</div>
        </div>
      </ng-template>

      <!-- Group Template -->
      <ng-template let-group pTemplate="group">
        <div class="font-semibold text-primary p-2 border-bottom-1 border-300">
          {{ group.label }}
        </div>
      </ng-template>
    </p-select>

    <!-- Permissions Info Button -->
    <p-button
      (onClick)="showPermissions.set(!showPermissions())"
      [text]="true"
      class="ml-1"
      icon="pi pi-info-circle"
      pTooltip="View Role Permissions"
      severity="secondary"
      size="small"
      tooltipPosition="bottom"
      />
  </div>

  <!-- Permissions Panel -->
  @if (showPermissions() && selectedRole()) {
    <div
      class="permissions-panel mt-3 p-3 border-1 border-300 border-round surface-card shadow-2"
      >
      <div class="flex align-items-center justify-content-between mb-3">
        <h6 class="m-0 text-primary">{{ currentRoleOption()?.label }} Permissions</h6>
        <p-button
          (onClick)="showPermissions.set(false)"
          [text]="true"
          icon="pi pi-times"
          size="small"
          />
      </div>
      <div class="grid">
        @for (permission of permissionsList(); track permission) {
          <div class="col-12 md:col-6">
            <div class="flex align-items-center gap-2 mb-2">
              <i
            [class]="
                  permission.hasPermission
                    ? 'pi pi-check text-green-500'
                    : 'pi pi-times text-red-500'
                "
                class="text-sm"
              ></i>
              <span
                [class.font-medium]="permission.hasPermission"
                [class.text-600]="!permission.hasPermission"
                class="text-sm"
                >
                {{ permission.label }}
              </span>
            </div>
          </div>
        }
      </div>
      <div class="mt-3 p-2 bg-blue-50 border-round">
        <p class="text-sm text-blue-800 m-0">
          <i class="pi pi-info-circle mr-2"></i>
          {{ currentRoleOption()?.description }}
        </p>
      </div>
    </div>
  }
</div>
